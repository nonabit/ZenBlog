---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import FusionHeader from "../components/react/FusionHeader";
import FusionFooter from "../components/react/FusionFooter";
import ScrollProgress from "../components/react/ScrollProgress";
import SiliconBackground from "../components/react/SiliconBackground";
import GiscusComments from "../components/react/GiscusComments";
import { ArrowLeft, Calendar, Clock } from "lucide-react";
import { translations } from "@/i18n/translations";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, heroImage } = Astro.props;

// 检测语言：根据 URL 路径判断
const lang = Astro.url.pathname.startsWith('/zh/') ? 'zh' : 'en';
const t = translations[lang];

// 简单的日期格式化
const formattedDate = pubDate.toLocaleDateString(lang === 'zh' ? "zh-CN" : "en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
});
---

<!-- 优化 1: 将语言改为 zh-CN，有助于浏览器正确渲染中文字体 -->
<html lang={lang === 'zh' ? 'zh-CN' : 'en'}>
    <head>
        <!-- 保留你的 OG Image 逻辑 -->
        <BaseHead
            title={title}
            description={description}
            image={`/og/${Astro.params.slug}.png`}
        />
    </head>

    <body
        class="bg-white text-zinc-800 transition-colors duration-500 antialiased font-sans"
    >
        <SiliconBackground client:load />
        <!-- 1. 进度条 -->
        <ScrollProgress client:load />

        <!-- 2. 全局导航 (保留你的 transition:persist) -->
        <FusionHeader client:load currentPath={lang === 'zh' ? '/zh/blog' : '/blog'} lang={lang} translations={t} />

        <main class="max-w-3xl mx-auto px-6 py-12 sm:py-20 relative z-10">
            <!-- 3. 文章头部 (Hero) -->
            <article
                class="animate-in fade-in slide-in-from-bottom-4 duration-700"
            >
                <div class="mb-10 text-center">
                    <a
                        href="/"
                        class="inline-flex items-center gap-1 text-lg font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors mb-8 no-underline"
                    >
                        <ArrowLeft size={15} />
                        <span>cd ..</span>
                    </a>

                    <div
                        class="flex items-center justify-center gap-4 text-xs font-mono text-zinc-400 mb-6 uppercase tracking-wider"
                    >
                        <span class="flex items-center gap-1">
                            <Calendar size={12} />
                            {formattedDate}
                        </span>
                        <span class="w-px h-3 bg-zinc-200 dark:bg-zinc-800"
                        ></span>
                        <span class="flex items-center gap-1">
                            <Clock size={12} /> 5 min read
                        </span>
                    </div>

                    <h1
                        class="font-serif text-[2rem] font-bold text-zinc-900 leading-[1.3] mb-6"
                    >
                        {title}
                    </h1>

                    {
                        heroImage && (
                            <div class="relative aspect-video w-full overflow-hidden rounded-xl mt-8 border border-zinc-100 dark:border-zinc-800">
                                {/* 保留你的 src 处理方式 */}
                                <img
                                    src={heroImage.src}
                                    alt={title}
                                    class="object-cover w-full h-full"
                                />
                            </div>
                        )
                    }
                </div>

                <hr class="border-zinc-100 dark:border-zinc-800 mb-12" />

                <!-- 4. Markdown 正文 - 使用自定义 prose 样式 -->
                <div class="prose max-w-none">
                    <slot />
                </div>
            </article>

            <!-- 5. 评论区 -->
            <section class="mt-16 pt-12 border-t border-zinc-100">
                <h2 class="font-serif text-2xl font-bold text-zinc-900 mb-8">
                    评论
                </h2>
                <GiscusComments client:load />
            </section>
        </main>

        {/* 统一的页脚 */}
        <FusionFooter client:visible translations={t} />
    </body>
</html>
