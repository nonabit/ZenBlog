---
import BaseHead from "../../components/BaseHead.astro";
import FusionHeader from "../../components/react/FusionHeader";
import BlogList from "../../components/react/BlogList";
import FusionFooter from "../../components/react/FusionFooter";
import { SITE_TITLE } from "../../consts";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { translations } from "@/i18n/translations";

const lang = 'en';
const t = translations[lang];

// 1. 获取原始数据并按语言过滤（en/ 目录），然后排序
const allPosts = (await getCollection("blog"))
	.filter((post: CollectionEntry<"blog">) => post.id.startsWith("en/"))
	.sort(
		(a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
			b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
	);

// 2. 数据清洗：确保传给 React 的是纯净的 JSON 对象
const posts = allPosts.map((post: CollectionEntry<"blog">) => ({
	slug: post.id.replace(/^en\//, "").replace(/\.[^/.]+$/, ""),
	data: {
		title: post.data.title,
		description: post.data.description,
		pubDate: post.data.pubDate,
	},
}));
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead
			title={`${t['nav.blog']} | ${SITE_TITLE}`}
			description="Writings and thoughts."
		/>
	</head>
	<body class="bg-white dark:bg-black transition-colors duration-500">
		{/* 头部导航 */}
		<FusionHeader client:load currentPath="/blog" lang={lang} translations={t} />

		<main class="max-w-5xl mx-auto px-6 py-12 sm:py-20 relative z-10">
			{/* 博客列表组件 */}
			<BlogList client:load posts={posts} lang={lang} translations={t} />
		</main>

		{/* 统一的页脚 */}
		<FusionFooter client:visible translations={t} />
	</body>
</html>
